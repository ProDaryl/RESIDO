<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Data Fetch Example</title>
    <style>
        .error-message {
            color: #ff4d4d;
            font-size: 14px;
            margin-bottom: 15px;
            background-color: #ffe6e6;
            border: 1px solid #ff4d4d;
            padding: 10px;
            border-radius: 5px;
            animation: fadeout 7s forwards;
        }  

        /* Define the fade-out animation */
        @keyframes fade-out {
            from {
                display: block; 
            }
            to {
                display: none; 
            }
        }

       
    </style>
</head>
<body>
    <h1>Register</h1>
    <div id="response-message" class="error-message">{{message}}</div>
    <form id="registerForm">
        <label for="first_name">First Name:</label>
        <input type="text" id="first_name" name="first_name" required><br><br>

        <label for="last_name">Last Name:</label>
        <input type="text" id="last_name" name="last_name" required><br><br>

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required><br><br>

        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required><br><br>

        <label for="confirmPass">Confirm Password:</label>
        <input type="password" id="confirmPass" name="confirmPass" required><br><br>

        <label for="is_realtor">Are you a Realtor?</label>
        <select id="is_realtor" name="is_realtor" required>
            <option value="False">No</option>
            <option value="True">Yes</option>
        </select><br><br>

        <button id="button" type="button">Register</button>
    </form>

    <script>
        document.getElementById('button').addEventListener('click', function(event) {
            event.preventDefault();  // Prevent default form submission

            // Retrieve form data
            let fName = document.getElementById('first_name');
            let lName = document.getElementById('last_name');
            let email = document.getElementById('email');
            let password = document.getElementById('password');
            let confirmPass = document.getElementById('confirmPass');
            let isRealtor = document.getElementById('is_realtor');

            // Create the formData object
            const formData = {
                first_name: fName,
                last_name: lName,
                email: email,
                password: password,
                re_password: confirmPass,
                is_realtor: isRealtor
            };

            // Log the form data to the console
            console.log("Form Data:", formData);

            // Get the CSRF token from the cookie
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');

            // Send the POST request to the API
            fetch('/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken // Use correct token
                },
                body: JSON.stringify(formData)
            })
            .then(response => {
                // Check if the response is okay (status code 200-299)
                if (!response.ok) {
            return response.json().then(err => {
                const messageDiv = document.querySelector('.error-message');
                messageDiv.innerHTML = `<p>${data.error}</p>`
                // messageDiv.classList.add('fade-out');
            });
        }
                return response.json();
            })
            .then(data => {
                // If registration is successful, redirect
                if (data.success) {
                    window.location.href = '/';
                } else {
                    // Display error message on the same page
                    const messageDiv = document.querySelector('.error-message');
                    messageDiv.innerHTML = `<p>${data.error}</p>`;
                    messageDiv.classList.add('fade-out');
                    setTimeout(() => {
                        messageDiv.classList.remove('fade-out');
                    }, 5);
                }
            })
            .catch(error => {
                // Display generic error message without showing API page
                console.error('There was a problem with the fetch operation:', error);
                document.getElementById('response-message').innerHTML = `<p>${error.message}</p>`;
            });
        });
    </script>
</body>
</html>
